function saveGame(){var e={};e.sudoku=sudoku,e.myTimer=myTimer,e.settings={medium:medium,difficulty:difficulty,showPossibleValues:showPossibleValues,showClashes:showClashes},localStorage.setItem("savedGame",JSON.stringify(e))}function resumeSavedGame(){var e=JSON.parse(localStorage.getItem("savedGame"));return e?(sudoku=e.sudoku,sudoku.__proto__=SudokuGame.prototype,myTimer.stop(),myTimer=e.myTimer,myTimer.__proto__=Timer.prototype,medium=e.settings.medium,difficulty=e.settings.difficulty,showPossibleValues=e.settings.showPossibleValues,showClashes=e.settings.showClashes,console.log("resuming saved game..."),restoreUI(),!0):!1}function restoreUI(){console.log("restoring UI..."),drawPuzzleDom(sudoku.playersGrid),disableCells(),styleGuessCells(medium),markConflicts(),myTimer.refreshTimeDom(),myTimer.isStopped?myTimer.stop():myTimer.start(),$("#game-settings-options .possible-values").prop("checked",showPossibleValues),$("#game-settings-options .highlight-clashes").prop("checked",showClashes),$("#pallete input[value='"+medium+"']").prop("checked",!0),$("#game-details .difficulty").html(difficulty)}function validCell(){$("#soduku-board input:focus").blur(),$(".ui-icon-minus").hide(),$(".ui-icon-plus").hide(),$("#cell-valid").hide()}function newPuzzle(e){sudoku=new SudokuGame(e),drawPuzzleDom(sudoku.puzzle),disableCells(),clearConflictHighlights(),$("#game-details .difficulty").html(difficulty),myTimer.reset()}function toggleTimer(){timer_paused?(myTimer.start(),$("#timer-stop").val("Pause"),$("#timer-stop").css("color","#000"),$(".time-passed").css("color","#000"),$(".ui-header").css("border-color","#ddd"),$(".ui-footer").css("border-color","#ddd"),$(".timer-wrapper").css("border-color","#ddd"),$("#pause-hider").css("display","none"),timer_paused=0):(myTimer.stop(),$("#timer-stop").val("Continue"),$("#timer-stop").css("color","#FF4848"),$(".time-passed").css("color","#FF4848"),$(".ui-header").css("border-color","#FF4848"),$(".ui-footer").css("border-color","#FF4848"),$(".timer-wrapper").css("border-color","#FF4848"),$("#pause-hider").css("display","block"),timer_paused=1)}function formatCellValue(e,s){var t=sudoku.playersGrid[e][s];return t=0===t?" ":t}function inputCellDom(e,s,t,a){$("td input").each(function(){var o=$(this).attr("data-cell").split(",");o[0]==e&&o[1]==s&&($(this).val(t),a&&$(this).removeClass().addClass(a))})}function drawPuzzleDom(e){$("td input").each(function(){var s=$(this).attr("data-cell").split(","),t=s[0],a=s[1],o=e[t][a],i=showPossibleValues?sudoku.getPossibleValuesForCell(e,t,a):{};if($(this).parent().removeClass().addClass("cell"),$(this).parent().css({"background-color":""}),$(this).siblings("h1").remove(),$(this).next().empty(),0===o){o=" ";for(var l in i.values)i.values[l]&&$(this).next().append(l)}$(this).val(o)})}function styleGuessCells(e){var s,t,a,o;$("td input").each(function(){s=$(this).attr("data-cell").split(","),t=s[0],a=s[1],o=sudoku.getPlayersGuesses(),0!==o[t][a]&&(e?$(this).removeClass().addClass(e):$(this).removeClass())})}function disableCells(){var e,s,t,a;$("td input").each(function(){e=$(this).attr("data-cell").split(","),s=e[0],t=e[1],a=!0,0===sudoku.puzzle[s][t]&&(a=!1),$(this).attr("disabled",a),$(this).removeClass()})}function markConflicts(){var e,s,t,a,o,i=sudoku.getPlayersGuesses();$("td input").each(function(){e=$(this).attr("data-cell").split(","),s=e[0],t=e[1],o=i[s][t],0!==o?(a=sudoku.getPossibleValuesForCell(sudoku.playersGrid,s,t,o).clash,$(this).next().removeClass().addClass(a.row||a.column||a.subgrid?"hint-overlay conflict":"hint-overlay")):$(this).next().removeClass().addClass("hint-overlay")})}function highlightClash(e,s,t){var a,o,i,l,u=sudoku.whichSubGrid(s,t);$("td input").each(function(){a=$(this).attr("data-cell").split(","),o=a[0],i=a[1],l=$(this).parent().parent(),l.removeClass(),e.row&&s===o&&l.addClass("clash"),e.column&&t===i&&l.addClass("clash"),e.subgrid&&o>=u.startRowIndex&&o<=u.endRowIndex&&i>=u.startColumnIndex&&i<=u.endColumnIndex&&l.addClass("clash")})}function clearConflictHighlights(){$("td input").each(function(){$(this).parent().parent().removeClass(),$(this).next().removeClass().addClass("hint-overlay")})}function weHaveAWinner(){for(var e,s,t,a="GOOD JOB!",o=["rgba(194,22,23,","rgba(212,40,25,","rgba(235,64,29,","rgba(253,82,31,","rgba(254,117,22,","rgba(254,163,9,","rgba(255,198,0,","rgba(181,179,26,","rgba(84,155,60,","rgba(10,136,86,","rgba(6,126,106,","rgba(2,116,127,","rgba(0,111,137,","rgba(48,95,131,","rgba(112,75,123,","rgba(160,59,117,","rgba(154,54,89,"],i=!1,l=1e3,u={};!i&&l>0;){e=0,s=Math.round(81*Math.random()),u[s]=!0,t=$("td input").eq(s);var n=o[Math.floor(o.length*Math.random())];n+="0.8)",t.attr("disabled",!0).val(""),setTimeout(function(e,s,t){return function(){e.parent().removeClass("win").addClass("win"),e.parent().append("<h1>"+a[s%9]+"</h1>"),e.parent().css({"background-color":t})}}(t,s,n),500);for(var r=0;81>r;r++)u[r]&&(e+=1);81===e&&(i=!0),l-=1}}function contentHeight(){var e=$.mobile.getScreenHeight(),s=$(".ui-header").hasClass("ui-header-fixed")?$(".ui-header").outerHeight()-1:$(".ui-header").outerHeight(),t=$(".ui-footer").hasClass("ui-footer-fixed")?$(".ui-footer").outerHeight()-1:$(".ui-footer").outerHeight(),a=$(".ui-content").outerHeight()-$(".ui-content").height(),o=e-s-t-a;$(".ui-content").height(o)}var $sudokuBoard=$("#soduku-board"),sudoku=new SudokuGame("normal"),myTimer=new GameTimer("#timer-1"),medium="pen",difficulty="normal",showPossibleValues=!1,showClashes=!1,maintainAspectRatio=function(e){e.css("",e.width())};$(document).on("load",function(){maintainAspectRatio($sudokuBoard),drawPuzzleDom(sudoku.puzzle),disableCells(),myTimer.start()}()),$(window).resize(function(){maintainAspectRatio($sudokuBoard)}),$("#soduku-board input").on("focus",function(){$(".ui-icon-minus").show(),$(".ui-icon-plus").show(),$("#cell-valid").show()}),$("#soduku-board input").on("blur",function(){}),$(".ui-icon-plus").click(function(){var e=parseInt($("input:focus").val());$("input:focus").val(isNaN(e)?1:e+1)}),$(".ui-icon-minus").click(function(){var e=parseInt($("input:focus").val());$("input:focus").val(!isNaN(e)&&e>1?e-1:1)}),$("#game-menu input").on("click",function(e){var s=e.target?e.target:e.srcElement;switch(s.className){case"select-new-puzzle":$("#game-menu .ui-block-a .ui-btn").toggleClass("ui-btn-active"),$("#game-menu .ui-block-b .ui-btn").removeClass("ui-btn-active"),$("#game-settings-options").hide(),$("#select-puzzle-options").toggle();break;case"game-settings":$("#game-menu .ui-block-b .ui-btn").toggleClass("ui-btn-active"),$("#game-menu .ui-block-a .ui-btn").removeClass("ui-btn-active"),$("#select-puzzle-options").hide(),$("#game-settings-options").toggle()}}),$("#game-settings-options input").on("click",function(e){var s=e.target?e.target:e.srcElement;switch(s.className){case"possible-values":showPossibleValues=s.checked,drawPuzzleDom(sudoku.playersGrid);break;case"highlight-clashes":showClashes=s.checked,showClashes?markConflicts():clearConflictHighlights()}}),$("#new-puzzle-options input").on("click",function(e){var s=e.target?e.target:e.srcElement;switch(s.className){case"oneGame":$.mobile.changePage("#playPage",{transition:"fade"}),$("#playPage").css("background-color","rgba(242,242,242,0.9)"),difficulty=s.value,newPuzzle(difficulty),setTimeout(function(){$("#popupOne").popup({transition:"slideup"}),$("#popupOne").popup({shadow:!1}),$("#popupOne").popup("open")},500);break;case"twoGame":$.mobile.changePage("#playPage",{transition:"fade"}),$("#playPage").css("background-color","rgba(0,0,0,0.9)"),difficulty=s.value,newPuzzle(difficulty),setTimeout(function(){$("#popupTwo").popup({transition:"slideup"}),$("#popupTwo").popup({shadow:!1}),$("#popupTwo").popup("open")},500);break;case"threeGame":$.mobile.changePage("#playPage",{transition:"fade"}),$("#playPage").css("background-color","rgba(16,138,229,0.9)"),difficulty=s.value,newPuzzle(difficulty),setTimeout(function(){$("#popupThree").popup({transition:"slideup"}),$("#popupThree").popup({shadow:!1}),$("#popupThree").popup("open")},500);break;case"fourGame":$.mobile.changePage("#playPage",{transition:"fade"}),$("#playPage").css("background-color","rgba(240,0,32,0.9)"),difficulty=s.value,newPuzzle(difficulty),setTimeout(function(){$("#popupFour").popup({transition:"slideup"}),$("#popupFour").popup({shadow:!1}),$("#popupFour").popup("open")},500);break;case"fiveGame":$.mobile.changePage("#playPage",{transition:"fade"}),$("#playPage").css("background-color","rgba(255,238,0,0.9)"),difficulty=s.value,newPuzzle(difficulty),setTimeout(function(){$("#popupFive").popup({transition:"slideup"}),$("#popupFive").popup({shadow:!1}),$("#popupFive").popup("open")},500)}}),$("#select-puzzle-options input").on("click",function(e){var s=e.target?e.target:e.srcElement;switch(s.className){case"oneLevel":difficulty=s.value,newPuzzle(difficulty),$("#playPage").css("background-color","#fff"),$("#select-puzzle-options").hide(),$("#defaultpanel").panel("close");break;case"twoLevel":difficulty=s.value,newPuzzle(difficulty),$("#playPage").css("background-color","#000"),$("#select-puzzle-options").hide(),$("#defaultpanel").panel("close");break;case"threeLevel":difficulty=s.value,newPuzzle(difficulty),$("#playPage").css("background-color","#108AE5"),$("#select-puzzle-options").hide(),$("#defaultpanel").panel("close");break;case"fourLevel":difficulty=s.value,newPuzzle(difficulty),$("#playPage").css("background-color","#F00020"),$("#select-puzzle-options").hide(),$("#defaultpanel").panel("close");break;case"fiveLevel":difficulty=s.value,newPuzzle(difficulty),$("#playPage").css("background-color","#FFEE00"),$("#select-puzzle-options").hide(),$("#defaultpanel").panel("close")}}),$("#hint").on("click",function(){var e=sudoku.giveHint();e.hint&&(inputCellDom(e.row,e.column,e.hint,"show-hint"),sudoku.playerInput(e.row,e.column,e.hint)),drawPuzzleDom(sudoku.playersGrid)});var timer_paused=0;$("#pallete .toggle-select").on("click",function(e){var s=e.target?e.target:e.srcElement;medium=s.value}),$sudokuBoard.on("focusin",function(e){var s=e.target?e.target:e.srcElement;$(s).removeClass().addClass(medium)}),$sudokuBoard.on("change",function(e){var s,t,a=$(e.target?e.target:e.srcElement),o=a.val(),i=a.attr("data-cell").split(","),l=i[0],u=i[1];a.removeClass().addClass(medium);try{showClashes&&(s=sudoku.getPossibleValuesForCell(sudoku.playersGrid,l,u,o),highlightClash(s.clash,l,u),markConflicts()),sudoku.playerInput(l,u,o),drawPuzzleDom(sudoku.playersGrid),sudoku.isComplete()&&sudoku.isSolved()&&(console.log("puzzle solved"),weHaveAWinner())}catch(n){t=formatCellValue(i[0],i[1]),a.val(t),console.log(n)}}),$sudokuBoard.on("focusout",function(e){var s,t,a=e.target?e.target:e.srcElement;if(!a.checkValidity())throw s=a.dataset.cell.split(","),t=formatCellValue(s[0],s[1]),$(a).val(t),{name:"invalidGuess",message:"a number between 1 and 9 is required"};$target=$(a),""===$target.val()&&$target.removeClass()}),$(document).on("pagecontainertransition",contentHeight),$(window).on("throttledresize orientationchange",contentHeight);
